<!DOCTYPE html>
<html>

<body>
  <h1>Test site</h1>

  <button onclick="getPixel()">Fetch next job</button>

  <div id="logs"></div>

  <script>
    const socket = new WebSocket('wss://PlaceMaster.overcastschool.repl.co/api/ws');
    socket.onopen = () => {
      console.log("Connected to server");
    };

    socket.onmessage = (msg) => {
      var data;
      try {
        data = JSON.parse(msg.data);
      } catch (e) {
        console.log("Invalid JSON: ", e, msg);
        return;
      }

      switch (data.type.toLowerCase()) {
        case "job":
          console.log("New job received: ", data.data);
          var p = document.createElement("p");
          p.innerHTML = "New job: " + JSON.stringify(data.data);
          document.getElementById("logs").appendChild(p);
          break;
        default:
          console.log("Data received: ", data);
          var p = document.createElement("p");
          p.innerHTML = "Data: " + JSON.stringify(data.data);
          document.getElementById("logs").appendChild(p);
          break;
      }
    };

    function getPixel() {
      socket.send(JSON.stringify({ type: "getJob" }));
    }
  </script>
</body>

</html>
